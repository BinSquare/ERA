---
title: API Reference
description: Complete ERA Agent API documentation
---

Complete reference for all ERA Agent API endpoints.

## Base URL

```
http://localhost:8787  # Default when running locally
```

## Endpoints

### POST /api/vm/create

Create a new virtual machine.

**Request Body:**
```json
{
  "language": "python" | "javascript" | "node" | "ruby" | "golang",  // Required
  "image": "string",              // Optional, override rootfs image
  "cpu": 1,                      // Optional, virtual CPUs (default: 1)  
  "memory": 256,                 // Optional, memory in MiB (default: 256)
  "network": "none" | "allow_all", // Optional, network policy (default: "none")
  "persist": false               // Optional, enable persistent volume (default: false)
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "string",
    "language": "string",
    "status": "string",
    "cpu_count": number,
    "memory_mib": number,
    "network_mode": "string",
    "persist": boolean,
    "created_at": "timestamp",
    "last_run_at": "timestamp"
  },
  "status_code": 201
}
```

**Example:**
```bash
curl -X POST http://localhost:8787/api/vm/create \
  -H "Content-Type: application/json" \
  -d '{
    "language": "python",
    "cpu": 2,
    "memory": 512,
    "network": "allow_all",
    "persist": true
  }'
```

---

### POST /api/vm/execute

Execute a command in an existing virtual machine.

**Request Body:**
```json
{
  "vm_id": "string",              // Required, target VM identifier
  "command": "string",            // Required, command to execute inside the guest
  "file": "string",               // Optional, file to stage inside /in
  "timeout": 30                   // Optional, execution timeout in seconds (default: 30)
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "vm_id": "string",
    "exit_code": number,
    "stdout": "string",
    "stderr": "string",
    "duration": "string"
  },
  "status_code": 200
}
```

**Example:**
```bash
curl -X POST http://localhost:8787/api/vm/execute \
  -H "Content-Type: application/json" \
  -d '{
    "vm_id": "abc123",
    "command": "python -c \"print(\\\"Hello from VM!\\\")\"",
    "timeout": 60
  }'
```

---

### POST /api/vm/temp

Execute a command in a temporary virtual machine (creates VM, runs command, then cleans up).

**Request Body:**
```json
{
  "language": "python" | "javascript" | "node" | "ruby" | "golang",  // Required
  "command": "string",            // Required, command to execute inside the guest
  "image": "string",              // Optional, override rootfs image
  "file": "string",               // Optional, file to stage inside /in
  "timeout": 30,                  // Optional, execution timeout in seconds (default: 30)
  "cpu": 1,                      // Optional, virtual CPUs (default: 1)
  "memory": 256,                 // Optional, memory in MiB (default: 256)
  "network": "none" | "allow_all", // Optional, network policy (default: "none")
  "persist": false               // Optional, enable persistent volume (default: false)
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "vm_id": "string",
    "exit_code": number,
    "stdout": "string",
    "stderr": "string",
    "duration": "string"
  },
  "status_code": 200
}
```

**Example:**
```bash
curl -X POST http://localhost:8787/api/vm/temp \
  -H "Content-Type: application/json" \
  -d '{
    "language": "python",
    "command": "print(2 + 2)",
    "cpu": 1,
    "memory": 256
  }'
```

---

### GET /api/vm/list

List all virtual machines.

**Query Parameters:**
- `status` (optional) - Filter by VM status
- `all` (optional) - Include stopped VMs (true/1 to include, default is false)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "string",
      "language": "string",
      "status": "string",
      "cpu_count": number,
      "memory_mib": number,
      "network_mode": "string",
      "persist": boolean,
      "created_at": "timestamp",
      "last_run_at": "timestamp"
    }
  ],
  "status_code": 200
}
```

**Example:**
```bash
curl http://localhost:8787/api/vm/list
# Include stopped VMs:
curl "http://localhost:8787/api/vm/list?all=true"
# Filter by status:
curl "http://localhost:8787/api/vm/list?status=ready"
```

---

### POST /api/vm/stop

Stop virtual machine(s).

**Request Body:**
```json
{
  "vm_id": "string"               // Optional, target VM identifier
}
```

**Query Parameters:**
- `all` (optional) - Stop all VMs (true/1 to stop all)

**Response:**
```json
{
  "success": true,
  "data": {
    "stopped": number
  },
  "status_code": 200
}
```

**Example:**
```bash
# Stop a specific VM
curl -X POST http://localhost:8787/api/vm/stop \
  -H "Content-Type: application/json" \
  -d '{
    "vm_id": "abc123"
  }'

# Stop all VMs
curl -X POST "http://localhost:8787/api/vm/stop?all=true"
```

---

### POST /api/vm/clean

Clean up virtual machine(s) (permanently delete).

**Request Body:**
```json
{
  "vm_id": "string",              // Optional, target VM identifier
  "keep_persist": false           // Optional, retain persistent volume (default: false)
}
```

**Query Parameters:**
- `all` (optional) - Clean all VMs (true/1 to clean all)

**Response:**
```json
{
  "success": true,
  "data": {
    "cleaned": number
  },
  "status_code": 200
}
```

**Example:**
```bash
# Clean a specific VM
curl -X POST http://localhost:8787/api/vm/clean \
  -H "Content-Type: application/json" \
  -d '{
    "vm_id": "abc123"
  }'

# Clean all VMs
curl -X POST "http://localhost:8787/api/vm/clean?all=true"

# Clean VM but keep persistent data
curl -X POST http://localhost:8787/api/vm/clean \
  -H "Content-Type: application/json" \
  -d '{
    "vm_id": "abc123",
    "keep_persist": true
  }'
```

---

### GET /

Serve the main web interface.

**Response:** HTML page

**Example:**
```bash
curl http://localhost:8787/
```

---

## Authentication

If the ERA_API_KEY environment variable is set, API endpoints (those starting with `/api/`) require authentication via the Authorization header:

```
Authorization: Bearer <your-api-key>
```

Web interface routes (`/`, `/index.html`, `/web/`) do not require authentication.

## Error Responses

All endpoints return standard error responses:

```json
{
  "success": false,
  "error": "string",
  "status_code": number
}
```

**Common HTTP Status Codes:**
- `200` - Success
- `201` - Created (new VM)
- `400` - Bad Request (invalid input)
- `401` - Unauthorized (authentication required)
- `500` - Internal Server Error

## Rate Limits

No rate limits are enforced by the server.

## Language Runtimes

### Python
- Version: Python 3.x (from base image)
- Standard library available
- Network access: Controlled by `network` parameter
- File I/O to VM filesystem

### Node.js
- Version: Node.js (from base image)
- Core modules available
- Network access: Controlled by `network` parameter
- File I/O to VM filesystem

### JavaScript
- Same as Node.js

### Ruby
- Version: Ruby (from base image)
- Standard library available
- Network access: Controlled by `network` parameter
- File I/O to VM filesystem

### Go
- Version: Go (from base image)
- Standard library available
- Network access: Controlled by `network` parameter
- File I/O to VM filesystem
