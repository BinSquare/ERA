---
title: MCP Server for Claude Desktop
description: Connect Claude Desktop to ERA Agent for AI-powered code execution
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

The Model Context Protocol (MCP) server allows Claude Desktop to execute code directly through ERA Agent. Claude can write, test, and debug code in multiple languages using natural language.

## Quick Start

### 1. Build ERA Agent

```bash
cd era-agent
go build -o agent
```

### 2. Get the Full Path

```bash
pwd
# Example output: /Users/yourname/era-agent
```

Your agent path: `/Users/yourname/era-agent/agent`

**Important:** You need the absolute path (starting with `/`), not a relative path.

### 3. Configure Claude Desktop

<Tabs>
<TabItem label="macOS">

Open the config file:
```bash
code ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

Add this configuration (update the path!):
```json
{
  "mcpServers": {
    "era-agent": {
      "command": "/Users/yourname/era-agent/agent",
      "args": ["mcp"],
      "env": {
        "AGENT_LOG_LEVEL": "info"
      }
    }
  }
}
```

</TabItem>
<TabItem label="Linux">

Open the config file:
```bash
code ~/.config/Claude/claude_desktop_config.json
```

Add this configuration (update the path!):
```json
{
  "mcpServers": {
    "era-agent": {
      "command": "/home/yourname/era-agent/agent",
      "args": ["mcp"],
      "env": {
        "AGENT_LOG_LEVEL": "info"
      }
    }
  }
}
```

</TabItem>
<TabItem label="Windows">

Open the config file:
```bash
notepad %APPDATA%\Claude\claude_desktop_config.json
```

Add this configuration (update the path!):
```json
{
  "mcpServers": {
    "era-agent": {
      "command": "C:\\Users\\yourname\\era-agent\\agent.exe",
      "args": ["mcp"],
      "env": {
        "AGENT_LOG_LEVEL": "info"
      }
    }
  }
}
```

</TabItem>
</Tabs>

### 4. Restart Claude Desktop

**Completely quit** Claude Desktop (not just close):
- **macOS:** Cmd+Q or Claude → Quit
- **Linux:** File → Quit
- **Windows:** File → Exit

Then restart Claude Desktop.

### 5. Test It

Try these prompts in Claude Desktop:

```
Execute this Python code:
print("Hello from ERA Agent!")
print(f"2 + 2 = {2 + 2}")
```

Claude should use the `era_execute_code` tool and show you the output.

## Available Tools

Once configured, Claude has access to 9 ERA Agent tools:

### 1. era_execute_code

Execute code in an ephemeral sandbox.

**Claude Usage:**
```
Execute this Python code:
import math
print(f"π ≈ {math.pi:.5f}")
```

**What It Does:**
- Creates temporary VM
- Executes code
- Returns output
- Cleans up automatically

### 2. era_create_session

Create a persistent execution environment.

**Claude Usage:**
```
Create a Python session with 2 CPUs and 512MB memory
```

**What It Does:**
- Creates named session
- Configures resources
- Returns session ID
- State persists between runs

### 3. era_run_in_session

Execute code in an existing session.

**Claude Usage:**
```
In session abc-123, run:
counter = 0
print(f"Counter: {counter}")

Then run:
counter += 1
print(f"Counter: {counter}")
```

**What It Does:**
- Executes in existing VM
- Maintains state/variables
- Faster than new VM each time

### 4. era_list_sessions

List all active sessions.

**Claude Usage:**
```
Show me all ERA Agent sessions
```

### 5. era_get_session

Get session details.

**Claude Usage:**
```
What's the status of session abc-123?
```

### 6. era_delete_session

Delete a session.

**Claude Usage:**
```
Delete session abc-123
```

### 7. era_upload_file

Upload a file to session workspace.

**Claude Usage:**
```
Upload a file called data.csv to session abc-123 with this content:
name,age
Alice,30
Bob,25
```

### 8. era_read_file

Read a file from session workspace.

**Claude Usage:**
```
Read the output.txt file from session abc-123
```

### 9. era_list_files

List files in session workspace.

**Claude Usage:**
```
What files are in session abc-123?
```

## Example Workflows

### Simple Execution

**You:** "Run this Python code: `print([x**2 for x in range(10)])`"

**Claude:** Uses `era_execute_code`

**Result:**
```
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
```

### Stateful Multi-Step

**You:** "Create a Python session and calculate the factorial of 10"

**Claude:**
1. Uses `era_create_session` → Gets session ID
2. Uses `era_run_in_session`:
   ```python
   def factorial(n):
       return 1 if n <= 1 else n * factorial(n-1)
   print(f"10! = {factorial(10)}")
   ```

**Result:** `10! = 3628800`

### Data Processing

**You:** "Create a Python session, upload this CSV, and analyze it"

**Claude:**
1. Uses `era_create_session`
2. Uses `era_upload_file` with CSV data
3. Uses `era_run_in_session` to:
   ```python
   import pandas as pd
   df = pd.read_csv('data.csv')
   print(df.describe())
   ```

### Multi-Language Testing

**You:** "Test this algorithm in Python and Node.js"

**Claude:**
1. Uses `era_execute_code` with `language: "python"`
2. Uses `era_execute_code` with `language: "node"`
3. Compares results

## Configuration Options

### Basic Configuration

Minimal setup:

```json
{
  "mcpServers": {
    "era-agent": {
      "command": "/path/to/agent",
      "args": ["mcp"]
    }
  }
}
```

### With Logging

Enable debug logs:

```json
{
  "mcpServers": {
    "era-agent": {
      "command": "/path/to/agent",
      "args": ["mcp"],
      "env": {
        "AGENT_LOG_LEVEL": "debug"
      }
    }
  }
}
```

### Custom State Directory

Store sessions in custom location:

```json
{
  "mcpServers": {
    "era-agent": {
      "command": "/path/to/agent",
      "args": ["mcp"],
      "env": {
        "AGENT_STATE_DIR": "/custom/path/to/state",
        "AGENT_LOG_LEVEL": "info"
      }
    }
  }
}
```

### Multiple Instances

Run multiple ERA Agent configurations:

```json
{
  "mcpServers": {
    "era-agent-default": {
      "command": "/path/to/agent",
      "args": ["mcp"]
    },
    "era-agent-debug": {
      "command": "/path/to/agent",
      "args": ["mcp"],
      "env": {
        "AGENT_LOG_LEVEL": "debug"
      }
    }
  }
}
```

## Troubleshooting

### Claude Doesn't Show ERA Tools

**Problem:** Configuration not loaded or server failed to start.

**Solutions:**

1. **Check config file syntax:**
   ```bash
   # Validate JSON
   cat ~/Library/Application\ Support/Claude/claude_desktop_config.json | jq '.'
   ```

2. **Verify agent path:**
   ```bash
   # Test the path
   /your/path/to/agent --help
   ```

3. **Check permissions:**
   ```bash
   chmod +x /path/to/agent
   ```

4. **Restart Claude Desktop completely** (Cmd+Q, not just close window)

5. **Check logs:**
   ```bash
   # macOS
   tail -f ~/Library/Logs/Claude/mcp*.log

   # Linux
   tail -f ~/.config/Claude/logs/mcp*.log
   ```

### Code Execution Fails

**Problem:** VM service error or Docker/Firecracker not running.

**Solutions:**

<Tabs>
<TabItem label="macOS">

1. **Open Docker Desktop**
2. **Verify Docker is running:**
   ```bash
   docker ps
   ```
3. **Restart Claude Desktop**

</TabItem>
<TabItem label="Linux">

1. **Check Firecracker:**
   ```bash
   which firecracker
   ```

2. **Verify KVM access:**
   ```bash
   ls -l /dev/kvm
   ```

3. **Add user to kvm group:**
   ```bash
   sudo usermod -aG kvm $USER
   # Log out and back in
   ```

</TabItem>
</Tabs>

### Timeout Errors

**Problem:** Code takes too long to execute.

**Solution:** Ask Claude to increase timeout:

```
Execute this code with a 60 second timeout:
[long-running code]
```

Or create session with higher default:

```
Create a Python session with a 120 second default timeout
```

### "Command not found"

**Problem:** Incorrect agent path in config.

**Solutions:**

1. **Use absolute path** (starting with `/`):
   ```json
   "command": "/Users/name/era-agent/agent"  // ✅ Good
   "command": "~/era-agent/agent"            // ❌ Bad
   "command": "./agent"                       // ❌ Bad
   ```

2. **Verify path exists:**
   ```bash
   ls -l /your/path/to/agent
   ```

### Agent Works in Terminal, Not in Claude

**Problem:** Environment variables or PATH not set.

**Solution:** Add environment variables to config:

```json
{
  "mcpServers": {
    "era-agent": {
      "command": "/path/to/agent",
      "args": ["mcp"],
      "env": {
        "AGENT_LOG_LEVEL": "info",
        "PATH": "/usr/local/bin:/usr/bin:/bin",
        "HOME": "/Users/yourname"
      }
    }
  }
}
```

## Usage Tips

### Effective Prompts

**Good Prompts:**
```
"Execute this Python code: print('Hello')"
"Create a Node.js session with network access"
"In session abc-123, run: x = 42"
"List all active sessions"
```

**Less Effective:**
```
"Can you run code?" (too vague)
"Execute: print(x)" (no context about language or session)
```

### Working with Sessions

**Create once, use multiple times:**
```
1. "Create a Python session"
2. "In that session, import pandas and load data.csv"
3. "Now calculate the mean of column 'age'"
4. "Create a visualization and save it"
5. "Read the output file"
```

### File Operations

**Upload, process, read:**
```
1. "Create a Python session"
2. "Upload requirements.txt with content: pandas numpy"
3. "Install the requirements"
4. "Upload data.csv with [data]"
5. "Process the data and save results"
6. "Read the results file"
```

## Security

### Isolation

- All code runs in isolated Firecracker VMs
- Network access disabled by default
- Filesystem isolation per session
- Resource limits enforced

### Network Access

Network is **disabled by default**. Enable only when needed:

```
Create a Python session with network access enabled
```

Claude will use `network_mode: "allow_all"`.

### State Storage

Sessions stored locally:
- macOS: `~/Library/Application Support/era-agent`
- Linux: `~/.local/share/era-agent`
- Custom: Set `AGENT_STATE_DIR`

Data never leaves your machine.

## Performance

### VM Startup

First execution in a session is slower (VM startup):
- First run: ~2-3 seconds
- Subsequent runs: ~0.5-1 second

**Tip:** Use persistent sessions for multiple operations.

### Resource Limits

Default limits:
- CPU: 1 core
- Memory: 256 MiB
- Timeout: 30 seconds

Request higher resources when needed:

```
Create a Python session with 4 CPUs and 2GB memory
```

## What Claude Can Build

With ERA Agent, Claude can:

### Data Analysis
```
"Analyze this CSV data and create summary statistics"
```

### API Integration
```
"Create a Python session with network access, fetch data from this API, and process it"
```

### Multi-File Projects
```
"Create a Node.js project with multiple files, install dependencies, and run tests"
```

### Algorithm Development
```
"Implement quicksort in Python, test it with random data, and measure performance"
```

### Web Scraping
```
"Create a Python session, install BeautifulSoup, scrape this URL, and extract data"
```

### Code Testing
```
"Test this function with various inputs and edge cases"
```

## Next Steps

- **Try Example Prompts:** Test the workflows above
- **Explore Languages:** Python, Node.js, TypeScript, Go, Deno
- **Read API Docs:** [API Reference](/docs/api-reference)
- **CLI Usage:** [Command Line Guide](/docs/local/cli-usage)
- **HTTP Server:** [Self-Hosted API](/docs/local/http-server)

## Additional Resources

- [MCP Protocol Specification](https://modelcontextprotocol.io)
- [ERA Agent GitHub](https://github.com/yourusername/era-agent)
- [Troubleshooting Guide](#troubleshooting)
- [Language Examples](/docs/examples/language-examples)
