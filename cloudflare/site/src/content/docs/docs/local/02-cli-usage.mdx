---
title: CLI Usage
description: Complete guide to using ERA Agent from the command line
---

The ERA Agent CLI provides direct command-line access to all VM management features. Perfect for quick testing, automation scripts, and manual session management.

## Installation

```bash
# Clone and build
git clone https://github.com/yourusername/era-agent
cd era-agent
go build -o agent

# Make it executable
chmod +x agent

# Optional: Add to PATH
sudo mv agent /usr/local/bin/
```

## Command Structure

```bash
agent [global-options] <command> [command-options]
```

## Global Options

```bash
--log-level <level>    # Set log level: debug, info, warn, error
```

Examples:
```bash
agent --log-level debug vm list
agent --log-level info vm create --language python
```

## Available Commands

### `agent vm create` - Create VM

Create a new isolated VM for code execution.

**Syntax:**
```bash
agent vm create --language <lang> [options]
```

**Required:**
- `--language <lang>` - Language: python, javascript, node, ruby, golang

**Optional:**
- `--image <image>` - Custom rootfs image (advanced)
- `--cpu <count>` - CPU count (default: 1)
- `--mem <mib>` - Memory in MiB (default: 256)
- `--network <mode>` - Network mode: none (default), allow_all
- `--persist` - Enable persistent volume for this VM

**Examples:**

Basic Python VM:
```bash
agent vm create --language python
# Output: INFO[vm created] id=abc123 language=python...
```

High-resource Node.js VM:
```bash
agent vm create \
  --language node \
  --cpu 2 \
  --mem 512
```

VM with network access:
```bash
agent vm create \
  --language python \
  --network allow_all
```

Persistent VM:
```bash
agent vm create \
  --language python \
  --persist
```

### `agent vm run` - Execute Code

Run code in an existing VM.

**Syntax:**
```bash
agent vm run --vm <id> --cmd <command> [options]
```

**Required:**
- `--vm <id>` - VM ID from `vm create`
- `--cmd <command>` - Command to execute inside the guest
- `--timeout <seconds>` - Execution timeout (must be greater than zero)

**Optional:**
- `--file <path>` - Optional file to stage inside /in

**Examples:**

Execute direct command:
```bash
agent vm run \
  --vm abc123 \
  --cmd "python -c 'print(2 + 2)'" \
  --timeout 30
```

Execute from file:
```bash
agent vm run \
  --vm abc123 \
  --cmd "python script.py" \
  --file ./script.py \
  --timeout 30
```

### `agent vm exec` - Execute on Multiple VMs

Execute code across multiple VMs.

**Syntax:**
```bash
agent vm exec --cmd <command> [--vm <id> ... | --all] [options]
```

**Required:**
- `--cmd <command>` - Command to execute inside the guest
- `--timeout <seconds>` - Execution timeout (must be greater than zero)

**Optional:**
- `--file <path>` - Optional file to stage inside /in
- `--vm <id>` - Target VM identifier (repeatable)
- `--all` - Execute on all ready VMs

**Examples:**

Execute on specific VMs:
```bash
agent vm exec \
  --vm abc123 \
  --vm def456 \
  --cmd "python -c 'print(\\\"Hello from VM\\\")'" \
  --timeout 30
```

Execute on all VMs:
```bash
agent vm exec \
  --all \
  --cmd "python -c 'print(\\\"Hello from all VMs\\\")'" \
  --timeout 30
```

### `agent vm temp` - Execute in Temporary VM

Execute code in a temporary VM that is automatically cleaned up after execution.

**Syntax:**
```bash
agent vm temp --language <lang> --cmd <command> [options]
```

**Required:**
- `--language <lang>` - Language: python, javascript, node, ruby, golang
- `--cmd <command>` - Command to execute inside the guest
- `--timeout <seconds>` - Execution timeout (must be greater than zero)

**Optional:**
- `--image <image>` - Custom rootfs image
- `--file <path>` - Optional file to stage inside /in
- `--cpu <count>` - CPU count (default: 1)
- `--mem <mib>` - Memory in MiB (default: 256)
- `--network <mode>` - Network mode: none (default), allow_all
- `--persist` - Enable persistent volume

**Examples:**

Temporary Python execution:
```bash
agent vm temp \
  --language python \
  --cmd "print('Hello from temp VM!')" \
  --timeout 30
```

Temporary high-resource execution:
```bash
agent vm temp \
  --language python \
  --cmd "python script.py" \
  --cpu 2 \
  --mem 512 \
  --timeout 60
```

### `agent vm shell` - Interactive Shell

Get interactive shell access to a VM.

**Syntax:**
```bash
agent vm shell --vm <id> [options]
```

**Required:**
- `--vm <id>` - VM ID from `vm create`

**Optional:**
- `--cmd <command>` - Shell command to execute (default: /bin/bash)

**Example:**
```bash
agent vm shell --vm abc123
```

### `agent vm list` - List VMs

List all active VMs.

**Syntax:**
```bash
agent vm list [options]
```

**Optional:**
- `--status <state>` - Filter by VM status
- `--all` - Include stopped VMs

**Example:**
```bash
agent vm list
# Output:
# ID      Language  Status  CPU  Mem(MiB)  Persist  Created             Last Run
# abc123  python    ready   1    256       no       2025-01-15 10:30:05 -
#
# Total: 1

# Include stopped VMs:
agent vm list --all

# Filter by status:
agent vm list --status ready
```

### `agent vm stop` - Stop VM

Stop a running VM (keeps state for later restart).

**Syntax:**
```bash
agent vm stop [--vm <id> ... | --all]
```

**Optional:**
- `--vm <id>` - VM identifier to stop (repeatable)
- `--all` - Stop all VMs

**Example:**
```bash
agent vm stop --vm abc123
```

### `agent vm clean` - Clean VM

Permanently delete a VM and clean up resources.

**Syntax:**
```bash
agent vm clean [--vm <id> ... | --all] [--keep-persist]
```

**Optional:**
- `--vm <id>` - VM identifier to clean (repeatable)
- `--all` - Clean all VMs
- `--keep-persist` - Keep persistent storage even after deletion

**Examples:**

Clean specific VM:
```bash
agent vm clean --vm abc123
```

Clean but keep persistent data:
```bash
agent vm clean --vm abc123 --keep-persist
```

Clean all VMs:
```bash
agent vm clean --all
```

### `agent server` - Start HTTP Server

Start ERA Agent as an HTTP API server.

**Syntax:**
```bash
agent server [--addr :port]
```

**Optional:**
```bash
--addr :port            # Server address (default: :8080)
```

**Environment Variables:**
```bash
PORT=8787              # Server port (default: 8080)
AGENT_LOG_LEVEL=info   # Log level
ERA_API_KEY=secret     # API key for authentication (optional)
```

**Example:**
```bash
PORT=9000 agent server
# Or with explicit address
agent server --addr :9000
```

See [HTTP Server Mode](/docs/local/http-server) for complete API documentation.

### `agent mcp` - Start MCP Server

Start ERA Agent as an MCP server for Claude Desktop integration.

**Syntax:**
```bash
agent mcp
```

**Environment Variables:**
```bash
AGENT_LOG_LEVEL=info   # Log level
AGENT_STATE_DIR=/path  # State directory
```

**Example:**
```bash
AGENT_LOG_LEVEL=debug agent mcp
```

See [MCP Server Setup](/docs/local/mcp-server) for Claude Desktop configuration.

### `agent --help` / `agent -h` / `agent help`

Display help information.

```bash
agent --help
```

## Common Workflows

### Quick Script Execution

Run a one-off Python script:

```bash
# Use temporary VM (automatically cleaned up)
agent vm temp --language python --cmd "print('Hello from temp VM!')" --timeout 30

# Or create, run, and clean manually
VM_ID=$(agent vm create --language python | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)
agent vm run --vm $VM_ID --cmd "python script.py" --timeout 30
agent vm clean --vm $VM_ID
```

### Stateful Multi-Step Execution

Execute multiple steps with shared state:

```bash
# Create persistent VM
VM_ID=$(agent vm create --language python --persist | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)

# Step 1: Initialize data
agent vm run --vm $VM_ID --cmd "python -c 'data = [1, 2, 3, 4, 5]; print(data)'" --timeout 30

# Step 2: Process data (state persists)
agent vm run --vm $VM_ID --cmd "python -c 'result = sum(data); print(f\"Sum: {result}\")'" --timeout 30

# Step 3: More processing
agent vm run --vm $VM_ID --cmd "python -c 'avg = sum(data) / len(data); print(f\"Average: {avg}\")'" --timeout 30

# Clean up when done
agent vm clean --vm $VM_ID
```

### Package Installation

Install packages in a VM:

```bash
# Create VM with network access
VM_ID=$(agent vm create --language python --network allow_all | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)

# Install packages
agent vm run --vm $VM_ID --cmd "pip install requests numpy" --timeout 60

# Use packages
agent vm run --vm $VM_ID --cmd "python -c 'import requests; print(requests.get(\"https://api.github.com\").status_code)'" --timeout 30

# Clean up
agent vm clean --vm $VM_ID
```

### Testing Multiple Languages

Test code across different runtimes:

```bash
#!/bin/bash

# Test in Python
VM_ID=$(agent vm create --language python | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)
agent vm run --vm $VM_ID --cmd "python -c 'print(\"Hello from Python\")'" --timeout 30
agent vm clean --vm $VM_ID

# Test in Node.js
VM_ID=$(agent vm create --language node | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)
agent vm run --vm $VM_ID --cmd "node -e 'console.log(\"Hello from Node.js\")'" --timeout 30
agent vm clean --vm $VM_ID

# Test in Ruby (if Ruby image is available)
VM_ID=$(agent vm create --language ruby | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)
agent vm run --vm $VM_ID --cmd "ruby -e 'puts \"Hello from Ruby\"'" --timeout 30
agent vm clean --vm $VM_ID
```

## Shell Integration

### Bash Helper Functions

Add to your `~/.bashrc` or `~/.bash_profile`:

```bash
# Quick Python execution
era-python() {
    agent vm temp --language python --cmd "$1" --timeout 30
}

# Quick Node.js execution
era-node() {
    agent vm temp --language node --cmd "$1" --timeout 30
}

# Create and remember VM
era-vm() {
    local language=$1
    export ERA_VM=$(agent vm create --language $language | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)
    echo "Created VM: $ERA_VM"
}

# Run in current VM
era-run() {
    agent vm run --vm $ERA_VM --cmd "$1" --timeout 30
}

# Clean up current VM
era-done() {
    agent vm clean --vm $ERA_VM
    unset ERA_VM
}
```

**Usage:**
```bash
# Quick execution
era-python "print(2 + 2)"

# VM workflow
era-vm python
era-run "python -c 'x = 42; print(x)'"
era-run "python -c 'print(x * 2)'"  # State persists
era-done
```

### Fish Shell Functions

Add to your `~/.config/fish/config.fish`:

```fish
function era-python
    agent vm temp --language python --cmd "$argv" --timeout 30
end

function era-vm
    set -gx ERA_VM (agent vm create --language $argv[1] | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)
    echo "Created VM: $ERA_VM"
end

function era-run
    agent vm run --vm $ERA_VM --cmd "$argv" --timeout 30
end

function era-done
    agent vm clean --vm $ERA_VM
    set -e ERA_VM
end
```

## Automation Scripts

### CI/CD Integration

```bash
#!/bin/bash
# test-runner.sh - Run tests in isolated environment

set -e

echo "Creating test environment..."
VM_ID=$(agent vm create \
  --language python \
  --network allow_all \
  | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)

echo "Installing dependencies..."
agent vm run --vm $VM_ID --cmd "pip install -r requirements.txt" --timeout 60

echo "Running tests..."
agent vm run --vm $VM_ID --cmd "pytest tests/" --timeout 300

echo "Cleaning up..."
agent vm clean --vm $VM_ID

echo "Tests passed! âœ…"
```

### Batch Processing

```bash
#!/bin/bash
# process-files.sh - Process multiple files

VM_ID=$(agent vm create --language python | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)

for file in data/*.csv; do
    echo "Processing $file..."
    agent vm run \
      --vm $VM_ID \
      --cmd "python process.py" \
      --timeout 60
done

agent vm clean --vm $VM_ID
```

### Scheduled Tasks

```bash
#!/bin/bash
# cron-task.sh - Run scheduled data processing

VM_ID=$(agent vm create \
  --language python \
  --persist \
  --network allow_all \
  | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)

# Fetch and process data
agent vm run --vm $VM_ID --cmd "python fetch_data.py" --timeout 60
agent vm run --vm $VM_ID --cmd "python process_data.py" --timeout 60
agent vm run --vm $VM_ID --cmd "python send_report.py" --timeout 60

agent vm clean --vm $VM_ID
```

Add to crontab:
```bash
# Run every day at 2 AM
0 2 * * * /path/to/cron-task.sh >> /var/log/era-agent.log 2>&1
```

## Tips and Tricks

### VM ID Management

Save VM IDs for later use:

```bash
# Save to variable
VM_ID=$(agent vm create --language python | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)

# Use specific VM
agent vm run --vm $VM_ID --cmd "python script.py" --timeout 30
```

### Output Parsing

Extract specific output:

```bash
# Get command exit status (success/failure)
if agent vm temp --language python --cmd "python script.py" --timeout 30; then
    echo "Success!"
else
    echo "Failed!"
fi
```

### Error Handling

```bash
#!/bin/bash

VM_ID=$(agent vm create --language python | grep -o 'ID=[a-zA-Z0-9-]*' | cut -d'=' -f2 | head -n1 | cut -d' ' -f1)

# Run with error checking
if agent vm run --vm $VM_ID --cmd "python script.py" --timeout 30; then
    echo "Command executed successfully!"
else
    echo "Command failed!"
    agent vm clean --vm $VM_ID
    exit 1
fi

agent vm clean --vm $VM_ID
```

### Timeout Management

For long-running tasks:

```bash
# Set generous timeout
agent vm run \
  --vm $VM_ID \
  --cmd "python long_task.py" \
  --timeout 600  # 10 minutes
```

## Troubleshooting

### Command Not Found

```bash
# Check if agent is in PATH
which agent

# If not, use full path
/path/to/agent vm create --language python
```

### VM Not Found

```bash
# List all VMs
agent vm list

# Verify VM ID exists
agent vm list | grep <id>
```

### Timeout Errors

```bash
# Increase timeout
agent vm run --vm <id> --cmd "..." --timeout 120
```

### Permission Denied

```bash
# Make binary executable
chmod +x agent

# Check Docker/Firecracker permissions
docker ps  # macOS
ls -l /dev/kvm  # Linux
```

## Next Steps

- [MCP Server Setup](/docs/local/mcp-server) - Use with Claude Desktop
- [HTTP Server Mode](/docs/local/http-server) - API integration
- [API Reference](/docs/api-reference) - Full API documentation
- [Language Examples](/docs/examples/language-examples) - Language-specific guides
